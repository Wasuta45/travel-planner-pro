<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Planner Pro - ‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úàÔ∏è</text></svg>">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* === Global Styles === */
        body { 
            font-family: 'IBM Plex Sans Thai', sans-serif; 
            background-color: #f8f9fa; 
            color: #2c3e50; 
        }

        /* === 1. Navbar (Animation & Glass Effect) === */
        .navbar { 
            padding: 25px 50px; 
            position: fixed; 
            width: 100%; 
            top: 0; 
            z-index: 1000; 
            transition: 0.4s ease;
            background: transparent;
        }
        .navbar-brand { 
            font-weight: 700; font-size: 1.5rem; color: white !important; 
            text-shadow: 0 2px 10px rgba(0,0,0,0.2); 
        }
        .nav-link { 
            color: rgba(255,255,255,0.9) !important; font-weight: 500; transition: 0.3s; 
        }
        .nav-link:hover { transform: translateY(-2px); color: white !important; }

        /* ‡∏õ‡∏∏‡πà‡∏° Navbar State ‡∏õ‡∏Å‡∏ï‡∏¥ */
        .navbar .btn-login { border: 2px solid white; color: white; background: transparent; font-weight: 700; }
        .navbar .btn-login:hover { background: white; color: #11998e; }
        .navbar .btn-register { background: white; color: #11998e; border: none; font-weight: 700; }
        .navbar .btn-register:hover { background: #f0f0f0; }

        /* Navbar State ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Scrolled (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á) */
        .navbar.scrolled { 
            background: rgba(255, 255, 255, 0.98); 
            backdrop-filter: blur(15px); 
            padding: 15px 50px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
        }
        .navbar.scrolled .navbar-brand { color: #11998e !important; text-shadow: none; }
        .navbar.scrolled .nav-link { color: #555 !important; }
        .navbar.scrolled .nav-link:hover { color: #11998e !important; }
        
        .navbar.scrolled .btn-login { border: 2px solid #11998e; color: #11998e; }
        .navbar.scrolled .btn-login:hover { background: #11998e; color: white; }
        .navbar.scrolled .btn-register { background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%); color: white; }

        /* === 2. Hero Section === */
        .hero-section {
            height: 90vh; min-height: 650px;
            background-image: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.5)), 
                              url('https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover; background-position: center; background-attachment: fixed;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; color: white; position: relative; 
            transition: background-image 0.5s ease-in-out;
            margin-top: -80px; padding-top: 80px;
        }
        .hero-title { font-size: 4.5rem; font-weight: 800; text-shadow: 0 4px 20px rgba(0,0,0,0.4); margin-bottom: 15px; animation: fadeInUp 0.8s; }
        .hero-subtitle { font-size: 1.6rem; font-weight: 300; margin-bottom: 50px; opacity: 0.95; animation: fadeInUp 1s; }

        /* === 3. Search & Filters === */
        .search-container {
            background: white; padding: 10px; border-radius: 60px;
            display: flex; align-items: center; width: 100%; max-width: 800px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.25); animation: fadeInUp 1.2s;
        }
        .search-input { border: none; flex-grow: 1; padding: 15px 30px; font-size: 1.2rem; border-radius: 60px; outline: none; }
        .search-btn {
            background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);
            border: none; width: 60px; height: 60px; border-radius: 50%; color: white; font-size: 1.4rem;
            transition: 0.3s; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .search-btn:hover { transform: scale(1.08); box-shadow: 0 5px 20px rgba(17, 153, 142, 0.5); }

        .category-bar { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-top: 50px; animation: fadeInUp 1.4s; }
        .cat-pill {
            background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.4); color: white;
            padding: 12px 30px; border-radius: 40px; cursor: pointer; transition: 0.3s; 
            font-weight: 600; font-size: 1.05rem; text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .cat-pill:hover, .cat-pill.active {
            background: white; color: #11998e; transform: translateY(-5px); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.3); text-shadow: none; border-color: white;
        }

        /* === 4. Place Cards === */
        .content-section { padding: 80px 0; }
        .section-title { font-weight: 800; color: #2c3e50; font-size: 2.2rem; margin-bottom: 10px; }
        
        .place-card {
            height: 450px; border-radius: 25px; position: relative; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
        }
        .place-card:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 25px 50px rgba(0,0,0,0.2); }
        .place-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .place-card:hover .place-img { transform: scale(1.15); }
        
        .place-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.5) 60%, transparent);
            padding: 35px; color: white; display: flex; flex-direction: column; justify-content: flex-end;
            height: 100%; transition: 0.3s;
        }
        .place-title { font-weight: 800; font-size: 1.8rem; margin-bottom: 8px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .place-desc { font-size: 1rem; opacity: 0.9; margin-bottom: 20px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; font-weight: 300; line-height: 1.6; }

        .btn-add {
            background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.5); color: white;
            padding: 12px 20px; border-radius: 50px; font-weight: 700; font-size: 1rem;
            width: 100%; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-add:hover { background: white; color: #11998e; border-color: white; transform: scale(1.02); }

        /* === 5. Review Section === */
        .review-section { background: white; border-radius: 40px; padding: 60px 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); margin-bottom: 80px; }
        .review-card { background: #f8f9fa; border-radius: 20px; padding: 30px; border: 1px solid #eee; height: 100%; transition: 0.3s; }
        .review-card:hover { transform: translateY(-5px); background: white; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }

        /* Animations */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeInUp 0.6s ease-out; }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar { padding: 15px 20px; }
            .hero-title { font-size: 3rem; }
            .search-container { max-width: 90%; }
            .place-card { height: 350px; }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/"><i class="fa-solid fa-paper-plane me-2"></i>Travel Planner Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navContent">
                <ul class="navbar-nav me-auto"></ul>
                <div class="d-flex align-items-center" id="navAuthSection">
                    <a href="/login.html" class="btn btn-login rounded-pill px-4 me-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                    <a href="/register.html" class="btn btn-register rounded-pill px-4 shadow-sm">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
                </div>
            </div>
        </div>
    </nav>

    <section class="hero-section" id="heroSection">
        <h1 class="hero-title" id="heroTitle">‡∏™‡∏π‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏õ‡∏≠‡∏î</h1>
        <p class="hero-subtitle" id="heroSubtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏õ‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡πÇ‡∏•‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á</p>
        
        <form class="search-container" onsubmit="handleSearch(event)">
            <input type="text" id="searchInput" class="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÉ‡∏ô‡∏ù‡∏±‡∏ô...">
            <button type="submit" class="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
        </form>

        <div class="category-bar">
            <div class="cat-pill active" onclick="changeTheme('nature', '‡∏™‡∏π‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏õ‡∏≠‡∏î', '‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥‡∏ö‡∏≥‡∏ö‡∏±‡∏î', this)">
                <i class="fa-solid fa-tree"></i> ‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥
            </div>
            <div class="cat-pill" onclick="changeTheme('sea', '‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡∏ó‡∏∞‡πÄ‡∏•', '‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢‡∏£‡∏¥‡∏°‡∏´‡∏≤‡∏î', this)">
                <i class="fa-solid fa-water"></i> ‡∏ó‡∏∞‡πÄ‡∏•
            </div>
            <div class="cat-pill" onclick="changeTheme('city', '‡πÅ‡∏™‡∏á‡∏™‡∏µ‡πÉ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà', '‡πÑ‡∏•‡∏ü‡πå‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ñ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á', this)">
                <i class="fa-solid fa-city"></i> ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà
            </div>
            <div class="cat-pill" onclick="changeTheme('camp', '‡∏ô‡∏≠‡∏ô‡∏î‡∏π‡∏î‡∏≤‡∏ß ‡∏Å‡πà‡∏≠‡∏Å‡∏≠‡∏á‡πÑ‡∏ü', '‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á', this)">
                <i class="fa-solid fa-fire"></i> ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á
            </div>
            <div class="cat-pill" onclick="changeTheme('culture', '‡∏™‡∏á‡∏ö‡∏à‡∏¥‡∏ï‡πÉ‡∏à ‡πÑ‡∏´‡∏ß‡πâ‡∏û‡∏£‡∏∞', '‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡πÑ‡∏ó‡∏¢', this)">
                <i class="fa-solid fa-gopuram"></i> ‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°
            </div>
        </div>
    </section>

    <div class="container py-5 content-section">
        <div class="d-flex justify-content-between align-items-end mb-5">
            <div>
                <h3 class="section-title" id="recTitle">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h3>
                <p class="text-muted mb-0 fs-5">‡∏Ñ‡∏±‡∏î‡∏™‡∏£‡∏£‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            </div>
        </div>
        <div class="row g-4" id="recommendedList">
            <div class="col-12 text-center text-muted py-5">
                <i class="fa-solid fa-spinner fa-spin fa-3x mb-4"></i><p class="fs-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </div>
    </div>

    <div class="container mb-5">
        <div class="review-section">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div>
                    <h3 class="fw-bold text-dark mb-2" style="font-size: 2rem;">üí¨ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                    <p class="text-muted mb-0 fs-5">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Travel Planner </p>
                </div>
                <button class="btn btn-primary rounded-pill px-5 py-3 fw-bold shadow-lg fs-5" onclick="openReviewModal()" style="background: #11998e; border:none;">
                    <i class="fa-regular fa-pen-to-square me-2"></i>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
                </button>
            </div>
            <div class="row g-4" id="reviewList">
                <div class="col-12 text-center text-muted fs-5">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="placeDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 25px; overflow: hidden;">
                <div style="height: 300px; position: relative;">
                    <img id="detailImg" src="" style="width: 100%; height: 100%; object-fit: cover;">
                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-4" data-bs-dismiss="modal"></button>
                    <div class="position-absolute bottom-0 start-0 w-100 p-4" style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);">
                        <h2 id="detailName" class="text-white fw-bold mb-1"></h2>
                        <span id="detailPrice" class="badge bg-success rounded-pill"></span>
                    </div>
                </div>
                <div class="modal-body p-4">
                    <p id="detailDesc" class="text-muted fs-5 mb-4"></p>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
                        <h5 class="fw-bold m-0"><i class="fa-regular fa-comments me-2"></i>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</h5>
                        <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="togglePlaceReviewForm()">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
                    </div>

                    <div id="placeReviewForm" class="mb-4 p-3 bg-light rounded-4 d-none">
                        <div class="mb-2 text-warning fs-4" style="cursor: pointer;">
                            <i class="fa-regular fa-star" onclick="setPlaceRating(1)"></i>
                            <i class="fa-regular fa-star" onclick="setPlaceRating(2)"></i>
                            <i class="fa-regular fa-star" onclick="setPlaceRating(3)"></i>
                            <i class="fa-regular fa-star" onclick="setPlaceRating(4)"></i>
                            <i class="fa-regular fa-star" onclick="setPlaceRating(5)"></i>
                        </div>
                        <input type="hidden" id="placeRating" value="0">
                        <textarea id="placeComment" class="form-control mb-2" rows="2" placeholder="‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏á‡∏ö‡πâ‡∏≤‡∏á?"></textarea>
                        <button class="btn btn-primary btn-sm rounded-pill" onclick="submitPlaceReview()">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
                    </div>

                    <div id="placeReviewsList" style="max-height: 250px; overflow-y: auto;">
                        <div class="text-center text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏µ‡∏ß‡∏¥‡∏ß...</div>
                    </div>
                </div>
                <div class="modal-footer border-0 px-4 pb-4">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                    <button type="button" class="btn btn-primary rounded-pill px-5 fw-bold" id="btnAddFromDetail" style="background: #11998e; border:none;">
                        <i class="fa-solid fa-plus-circle me-2"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏£‡∏¥‡∏õ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="selectTripModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
                <div class="modal-header bg-white border-0 px-5 pt-5">
                    <h4 class="modal-title fw-bold text-dark">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ó‡∏£‡∏¥‡∏õ</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-5">
                    <p class="text-muted fs-5">‡πÄ‡∏û‡∏¥‡πà‡∏° <strong><span id="selectedPlaceName" class="text-primary"></span></strong> ‡∏•‡∏á‡πÉ‡∏ô‡∏ó‡∏£‡∏¥‡∏õ‡πÑ‡∏´‡∏ô‡∏î‡∏µ?</p>
                    <select id="tripSelector" class="form-select form-select-lg mb-3 bg-light border-0 py-3 rounded-4 fs-5">
                        <option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì --</option>
                    </select>
                    <div id="noTripAlert" class="alert alert-warning d-none border-0 bg-warning-subtle text-warning-emphasis rounded-4 p-3">
                        <i class="fa-solid fa-exclamation-circle me-2"></i>‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏£‡∏¥‡∏õ <a href="/dashboard.html" class="alert-link">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a>
                    </div>
                </div>
                <div class="modal-footer border-0 px-5 pb-5">
                    <button type="button" class="btn btn-light rounded-pill px-4 py-2 fs-5" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="button" class="btn btn-primary rounded-pill px-5 py-2 fw-bold fs-5" onclick="confirmAddToTrip()" style="background: #11998e; border:none;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏•‡∏¢</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="reviewModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 25px;">
                <div class="modal-header border-0 px-5 pt-5 pb-0">
                    <h4 class="modal-title fw-bold">‚úçÔ∏è ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏ß‡πá‡∏ö</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-5 pb-4 text-center">
                    <p class="text-muted mb-2 fs-5">‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à</p>
                    <div class="rating-stars mb-4 display-6 text-warning" style="cursor: pointer;">
                        <i class="fa-regular fa-star" onclick="setRating(1)"></i>
                        <i class="fa-regular fa-star" onclick="setRating(2)"></i>
                        <i class="fa-regular fa-star" onclick="setRating(3)"></i>
                        <i class="fa-regular fa-star" onclick="setRating(4)"></i>
                        <i class="fa-regular fa-star" onclick="setRating(5)"></i>
                    </div>
                    <input type="hidden" id="reviewRating" value="0">
                    <textarea id="reviewComment" class="form-control bg-light border-0 rounded-4 p-4 fs-5" rows="4" placeholder="‡πÄ‡∏•‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå..."></textarea>
                </div>
                <div class="modal-footer border-0 pt-0 px-5 pb-5">
                    <button class="btn btn-primary w-100 rounded-pill fw-bold py-3 fs-5" onclick="submitReview()" style="background: #11998e; border:none;">‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        // --- Variables ---
        let currentPlaceToAdd = null;
        let tripModal = null;
        let reviewModal = null;
        let placeDetailModal = null;
        let currentDetailPlaceId = null;

        // --- Navbar Scroll Logic ---
        window.addEventListener('scroll', () => {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) navbar.classList.add('scrolled');
            else navbar.classList.remove('scrolled');
        });

        // --- Theme Switcher ---
        function changeTheme(theme, title, sub, element) {
            document.getElementById('heroTitle').innerText = title;
            document.getElementById('heroSubtitle').innerText = sub;
            
        
            document.querySelectorAll('.cat-pill').forEach(el => el.classList.remove('active'));
            if(element) element.classList.add('active');

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Background
            const heroSection = document.getElementById('heroSection');
            let imgUrl = '';
            const images = {
                'nature': 'https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80',
                'sea': 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80',
                'city': 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80',
                'camp': 'https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80',
                'culture': 'https://images.unsplash.com/photo-1528181304800-259b08848526?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80'
            };
            imgUrl = images[theme] || images['nature'];
            heroSection.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.5)), url('${imgUrl}')`;
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            loadHomeData(theme);
        }

        // Load Home Data ---
        async function loadHomeData(theme = 'nature') {
            try {
                const list = document.getElementById('recommendedList');
                list.style.opacity = '0.5';

                // 1. Check Auth 
                const authRes = await fetch('/api/user/me');
                if (authRes.ok) {
                    const user = await authRes.json();
                    const seed = user.avatar_seed || user.username;
                    const avatarUrl = `https://api.dicebear.com/7.x/adventurer/svg?seed=${seed}`;

                    document.getElementById('navAuthSection').innerHTML = `
                        <a href="/dashboard.html" class="btn btn-login rounded-pill px-4 me-3">Dashboard</a>
                        <a href="/profile.html" class="text-decoration-none fw-bold d-flex align-items-center" style="color:inherit;">
                            <img src="${avatarUrl}" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; border: 2px solid white; background:white;">
                            <span class="d-none d-md-inline text-white" style="text-shadow: 0 1px 3px rgba(0,0,0,0.3);">${user.username}</span>
                        </a>`;
                }

                // 2. Load Places
                const res = await fetch(`/api/public/home-data?theme=${theme}`);
                const data = await res.json();

                list.style.opacity = '1';
                list.innerHTML = '';
                
                if (!data.recommendations || data.recommendations.length === 0) {
                    list.innerHTML = '<div class="col-12 text-center text-muted py-5"><h5>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</h5></div>'; 
                    return;
                }

                data.recommendations.forEach(place => {
                    list.innerHTML += createPlaceCardHTML(place);
                });
            } catch (err) { 
                console.error("Error:", err); 
            }
        }

        // --- Helper: Create HTML String ---
        function createPlaceCardHTML(place) {
            const imgUrl = place.image_url || 'https://via.placeholder.com/400x300';
            const placeDataStr = JSON.stringify(place).replace(/"/g, '&quot;');
            
            return `
                <div class="col-md-4 fade-in">
                    <div class="place-card" onclick="openPlaceDetail(${placeDataStr})">
                        <img src="${imgUrl}" class="place-img" alt="${place.name}">
                        <div class="place-overlay">
                            <h5 class="place-title">${place.name}</h5>
                            <p class="place-desc">${place.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                            <button class="btn-add" onclick="event.stopPropagation(); openAddToTrip(${placeDataStr})">
                                <i class="fa-solid fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏£‡∏¥‡∏õ
                            </button>
                        </div>
                    </div>
                </div>`;
        }

        // --- Search Logic ---
        async function handleSearch(event) {
            event.preventDefault();
            const query = document.getElementById('searchInput').value.trim();
            if(!query) { loadHomeData('nature'); return; }

            document.getElementById('recTitle').innerText = `‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: "${query}"`;
            const list = document.getElementById('recommendedList');
            list.innerHTML = '<div class="col-12 text-center py-5"><i class="fa-solid fa-spinner fa-spin fa-2x text-muted"></i></div>';

            try {
                const res = await fetch(`/api/search?q=${query}`);
                const results = await res.json();
                list.innerHTML = '';
                
                if (results.length === 0) { 
                    list.innerHTML = '<div class="col-12 text-center text-muted py-5"><h5>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ üòÖ</h5></div>'; 
                    return; 
                }
                results.forEach(place => {
                    list.innerHTML += createPlaceCardHTML(place);
                });
                
                // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                window.scrollTo({ top: document.querySelector('.content-section').offsetTop - 100, behavior: 'smooth' });
            } catch (err) { console.error(err); }
        }

        // --- Add Place to Trip ---
        async function openAddToTrip(place) {
            const authRes = await fetch('/api/user/me');
            if (!authRes.ok) { 
                Swal.fire({ icon: 'info', title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', confirmButtonText: 'Login' })
                    .then(() => window.location.href = '/login.html'); 
                return; 
            }

            const tripRes = await fetch('/api/my-trips');
            const tripData = await tripRes.json();
            
            currentPlaceToAdd = place;
            document.getElementById('selectedPlaceName').innerText = place.name;
            const selector = document.getElementById('tripSelector');
            const alertBox = document.getElementById('noTripAlert');
            
            selector.innerHTML = '<option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì --</option>';
            
            if (tripData.trips.length === 0) { 
                selector.disabled = true; 
                alertBox.classList.remove('d-none'); 
            } else { 
                selector.disabled = false; 
                alertBox.classList.add('d-none'); 
                tripData.trips.forEach(t => selector.innerHTML += `<option value="${t.id}">${t.name}</option>`); 
            }

            if (!tripModal) tripModal = new bootstrap.Modal(document.getElementById('selectTripModal'));
            tripModal.show();
        }

        async function confirmAddToTrip() {
            const tripId = document.getElementById('tripSelector').value;
            if (!tripId) { Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏¥‡∏õ‡∏Å‡πà‡∏≠‡∏ô', 'warning'); return; }
            
            try {
                const payload = { 
                    trip_id: tripId, 
                    name: currentPlaceToAdd.name, 
                    description: currentPlaceToAdd.description, 
                    price: currentPlaceToAdd.price, 
                    latitude: currentPlaceToAdd.latitude || 13.7563, 
                    longitude: currentPlaceToAdd.longitude || 100.5018 
                };
                
                const res = await fetch('/api/places', { 
                    method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) 
                });

                if (res.ok) { 
                    tripModal.hide(); 
                    Swal.fire({ 
                        icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', showCancelButton: true, confirmButtonText: '‡πÑ‡∏õ‡∏î‡∏π‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏•‡∏¢', cancelButtonText: '‡∏õ‡∏¥‡∏î' 
                    }).then((result) => { 
                        if (result.isConfirmed) window.location.href = `/trip-detail.html?id=${tripId}`; 
                    }); 
                } else throw new Error('Failed');
            } catch (err) { Swal.fire('Error', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error'); }
        }

        // --- Place Detail & Reviews Logic ---
        function openPlaceDetail(place) {
            if(!placeDetailModal) placeDetailModal = new bootstrap.Modal(document.getElementById('placeDetailModal'));
            
            currentDetailPlaceId = place.id;
            document.getElementById('detailName').innerText = place.name;
            document.getElementById('detailDesc').innerText = place.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°';
            document.getElementById('detailPrice').innerText = place.price > 0 ? `${Number(place.price).toLocaleString()} ‡∏ø` : 'FREE';
            document.getElementById('detailImg').src = place.image_url || 'https://via.placeholder.com/800x400';
            
            // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏£‡∏¥‡∏õ‡πÉ‡∏ô Modal
            const placeDataStr = JSON.stringify(place).replace(/"/g, '&quot;');
            document.getElementById('btnAddFromDetail').setAttribute('onclick', `openAddToTrip(${placeDataStr})`);
            
            loadPlaceReviews(place.id);
            document.getElementById('placeReviewForm').classList.add('d-none'); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            
            placeDetailModal.show();
        }

        async function loadPlaceReviews(placeId) {
            const list = document.getElementById('placeReviewsList');
            list.innerHTML = '<div class="text-center text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏µ‡∏ß‡∏¥‡∏ß...</div>';
            
            try {
                const res = await fetch(`/api/places/${placeId}/reviews`);
                const reviews = await res.json();
                list.innerHTML = '';
                
                if(reviews.length === 0) {
                    list.innerHTML = '<div class="text-center text-muted py-3">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡πÄ‡∏•‡∏¢‡πÑ‡∏´‡∏°?</div>';
                    return;
                }
                
                reviews.forEach(r => {
                    let stars = ''; for(let i=1; i<=5; i++) stars += i<=r.rating ? '<i class="fa-solid fa-star text-warning small"></i>' : '<i class="fa-regular fa-star text-muted small"></i>';
                    list.innerHTML += `
                        <div class="border-bottom py-3 d-flex">
                            <div style="width:40px; height:40px; background:#eee; border-radius:50%; margin-right:15px; overflow:hidden;">
                                 <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=${r.username}" style="width:100%;">
                            </div>
                            <div>
                                <div class="d-flex align-items-center mb-1">
                                    <h6 class="mb-0 fw-bold me-2">${r.username}</h6>
                                    <div>${stars}</div>
                                </div>
                                <p class="text-muted mb-0 small">"${r.comment}"</p>
                            </div>
                        </div>`;
                });
            } catch(e) { list.innerHTML = '<div class="text-danger text-center">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>'; }
        }

        function togglePlaceReviewForm() {
            document.getElementById('placeReviewForm').classList.toggle('d-none');
        }

        function setPlaceRating(n) {
            document.getElementById('placeRating').value = n;
            const stars = document.querySelectorAll('#placeReviewForm .fa-star');
            stars.forEach((s, i) => {
                if(i < n) { s.classList.remove('fa-regular'); s.classList.add('fa-solid'); }
                else { s.classList.remove('fa-solid'); s.classList.add('fa-regular'); }
            });
        }

        async function submitPlaceReview() {
            const rating = document.getElementById('placeRating').value;
            const comment = document.getElementById('placeComment').value;
            if(rating == 0) { Swal.fire('‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö', '', 'warning'); return; }
            
            const authRes = await fetch('/api/user/me');
            if(!authRes.ok) { Swal.fire({icon:'info', title:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', confirmButtonText:'Login'}).then(()=>window.location.href='/login.html'); return; }

            try {
                const res = await fetch(`/api/places/${currentDetailPlaceId}/reviews`, {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({rating, comment})
                });
                if(res.ok) {
                    document.getElementById('placeComment').value = ''; setPlaceRating(0); togglePlaceReviewForm();
                    loadPlaceReviews(currentDetailPlaceId);
                    Swal.fire({toast:true, position:'top-end', icon:'success', title:'‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÅ‡∏•‡πâ‡∏ß!', timer:2000, showConfirmButton:false});
                }
            } catch(e) { Swal.fire('Error', '‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error'); }
        }

        // --- Global Site Reviews ---
        async function loadReviews() {
            try {
                const res = await fetch('/api/reviews');
                const reviews = await res.json();
                const list = document.getElementById('reviewList');
                if(reviews.length===0) return;
                
                list.innerHTML = '';
                reviews.forEach(r => {
                    let stars = ''; for(let i=1; i<=5; i++) stars += i<=r.rating ? '<i class="fa-solid fa-star text-warning"></i>' : '<i class="fa-regular fa-star text-muted"></i>';
                    const avatarUrl = `https://api.dicebear.com/7.x/adventurer/svg?seed=${r.username}`;
                    list.innerHTML += `
                        <div class="col-md-4 fade-in">
                            <div class="review-card">
                                <div class="d-flex align-items-center mb-3">
                                    <img src="${avatarUrl}" style="width: 50px; height: 50px; border-radius: 50%; background: #f8f9fa; border: 1px solid #eee;">
                                    <div class="ms-3"><h6 class="fw-bold mb-0 text-dark fs-5">${r.username}</h6><small class="text-muted">${new Date(r.created_at).toLocaleDateString('th-TH')}</small></div>
                                </div>
                                <div class="mb-3 fs-5">${stars}</div>
                                <p class="text-secondary mb-0 fs-5" style="line-height:1.6">"${r.comment}"</p>
                            </div>
                        </div>`;
                });
            } catch(e) { console.error(e); }
        }

        // Functions for Global Review Modal
        function openReviewModal() { 
            if(!reviewModal) reviewModal = new bootstrap.Modal(document.getElementById('reviewModal')); 
            setRating(0); document.getElementById('reviewComment').value = ''; 
            reviewModal.show(); 
        }
        function setRating(n) { 
            document.getElementById('reviewRating').value = n; 
            document.querySelectorAll('.rating-stars i').forEach((s, i) => { 
                if(i<n) {s.classList.remove('fa-regular');s.classList.add('fa-solid');} 
                else {s.classList.remove('fa-solid');s.classList.add('fa-regular');} 
            }); 
        }
        async function submitReview() {
            const rating = document.getElementById('reviewRating').value; const comment = document.getElementById('reviewComment').value;
            if(rating==0) { Swal.fire('‡∏•‡∏∑‡∏°‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß!', '‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö', 'warning'); return; }
            const authRes = await fetch('/api/user/me');
            if(!authRes.ok) { Swal.fire({icon:'info', title:'‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞', confirmButtonText:'Login'}).then(()=>window.location.href='/login.html'); return; }
            try { 
                const res = await fetch('/api/reviews', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({rating, comment}) }); 
                if(res.ok) { reviewModal.hide(); Swal.fire('‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö!', '‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß', 'success'); loadReviews(); } 
            } catch(e) { Swal.fire('Error', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error'); }
        }

        // --- Init ---
        loadHomeData('nature');
        loadReviews();

    </script>
</body>
</html>